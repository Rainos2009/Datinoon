<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Datinoon - Original Mode</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root { --main-border: 2px solid #000; }
    body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; overflow: hidden; }
    .header { display: flex; align-items: center; justify-content: space-between; padding: 0 30px; border-bottom: var(--main-border); background: #fff; height: 70px; z-index: 2000; position: relative; }
    #map { width: 100vw; height: calc(100vh - 70px); }
    .login-btn { padding: 10px 20px; background: #4285F4; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>

<header class="header">
  <div style="display:flex; align-items:center;">
    <img src="images/Datinoon 0.3.2.png" height="45" style="border:var(--main-border);" onclick="location.reload()">
    <span style="margin-left:15px; font-weight:900; font-size:20px;">DATINOON</span>
  </div>
  <div id="auth-area">
    <button class="login-btn" onclick="handleGoogleLogin()">êµ¬ê¸€ë¡œ ë¡œê·¸ì¸</button>
  </div>
</header>

<div id="map"></div>

<script>
  const SUPABASE_URL = 'https://lhundplpkgafoozxmiyi.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_jngaJT3f3TOfJciY8LTW9A_AStej1TQ';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const map = L.map('map').setView([35.8714, 128.6014], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  // êµ¬ê¸€ ë¡œê·¸ì¸ í•¨ìˆ˜
  async function handleGoogleLogin() {
    const { error } = await supabaseClient.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: window.location.origin }
    });
    if (error) alert("ë¡œê·¸ì¸ ì˜¤ë¥˜: " + error.message);
  }

  // ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ ë° UI ë³€ê²½
  supabaseClient.auth.onAuthStateChange((event, session) => {
    const authArea = document.getElementById('auth-area');
    if (session) {
      const user = session.user.user_metadata;
      authArea.innerHTML = `
        <span style="font-weight:bold; margin-right:15px;">${user.full_name} ì‚¬ë ¹ê´€ë‹˜</span>
        <span style="cursor:pointer;" onclick="location.href='profile.html'">ğŸªª ì‹ ë¶„ì¦</span>
        <button onclick="supabaseClient.auth.signOut()" style="margin-left:10px;">ë¡œê·¸ì•„ì›ƒ</button>
      `;
    }
  });
</script>
</body>
</html>