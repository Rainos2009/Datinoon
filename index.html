<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Datinoon</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .glass-card {
      width: 300px; height: 200px; border-radius: 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      padding: 16px; color: #fff; transition: transform 0.3s ease;
    }
    .glass-card:hover { transform: translateY(-4px); }
  </style>
  <link rel="icon" href="images/Datinoon_favicon.png" type="image/png" />
</head>

<body>

<header class="header">
  <button class="hamburger" onclick="toggleSidebar()">â‰¡</button>
  <div class="left">
    <img src="images/Datinoon_0.3.1.png" class="logo" />
  </div>
  <div class="center">
    <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì°½" />
  </div>
  <div class="right">
    <button id="login-nav-btn" onclick="toggleLoginBox()" style="font-size:17px;">ë¡œê·¸ì¸</button>
    <div class="account-area" id="profile-account-area" style="display:none; cursor:pointer;" onclick="openMenu()">
      <img src="images/Datinoon_Pro.png" class="profile-logo" id="profile-img">
      <div class="profile-info">
        <span class="profile-name" id="profile-name"></span>
        <span class="profile-meta" id="profile-meta"></span>
      </div>
    </div>
  </div>
</header>

<aside class="sidebar" id="sidebar">
  <button class="close-sidebar" onclick="toggleSidebar()">âœ•</button>
  <div class="datinoon-net-section">
    <img src="images/DatinoonNet_2025.png" alt="Datinoon-Net 2025" style="width:100%; margin-bottom:10px;" />
    <p style="font-size:14px; color:#444;">ìƒˆë¡œìš´ ì •ë³´ë¥¼ ì „í•´ë“œë¦½ë‹ˆë‹¤!</p>
    <input type="text" placeholder="Datinoon-Net ê²€ìƒ‰..." style="width:90%; padding:5px; margin-top:10px;" />
    <button onclick="window.open('https://datinoon-login.web.app/', '_blank')" style="margin-top:10px;">ì´ë™í•˜ê¸°</button>
    <p style="font-size:13px; color:#666;">Datinoon-Netê³¼ ì—°ë™ëœ ë©”ì¸ í”Œë«í¼ì…ë‹ˆë‹¤.</p>
  </div>
  <hr style="margin:20px 0;" />
  <nav class="sidebar-nav">
    <ul>
      <li><a href="#">ğŸ“ ì±„ë„ íƒìƒ‰</a></li>
      <li><a href="#">ğŸ–¼ï¸ ì‚¬ì§„</a></li>
      <li><a href="#">ğŸï¸ ì˜ìƒ</a></li>
      <li><a href="#">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</a></li>
    </ul>
  </nav>
</aside>

<div id="overlay" onclick="toggleSidebar()"></div>

<main class="main-content">
  <div id="popup-menu" class="popup-menu" style="display:none;">
    <div class="popup-content">
      <ul>
        <li><a href="/Datinoon/profile.html">ë§ˆì´ í”„ë¡œí•„</a></li>
        <li><a href="javascript:void(0)" onclick="openSettingsModal()">ì„¤ì •</a></li>
        <li><a href="javascript:void(0)" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</a></li>
      </ul>
      <button onclick="closeMenu()" class="close-btn">ë‹«ê¸°</button>
    </div>
  </div>

  <section class="intro">
    <h2>Datinoonì´ë€?</h2>
    <p>ëˆ„êµ¬ë‚˜ ì‚¬ì§„ê³¼ ì˜ìƒì„ ê³µìœ í•˜ê³  ì¶”ì–µì„ ë§Œë“œëŠ” ììœ ë¡œìš´ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.</p>
  </section>

  <section class="sample-content">
    <h2>ğŸ”¥ ì¸ê¸° ì½˜í…ì¸ </h2>
    <div class="card-list" id="card-list"></div>
  </section>
</main>

<div id="login-box" style="display:none;" class="modal-overlay">
  <div class="login-content">
    <img src="images/Datinoon_0.3.1.png" style="width:160px; margin: 28px 0 18px 0;">
    <div style="font-size: 16px; color:#333; margin-bottom:18px;">
      Datinoonì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br>êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.
    </div>
    <button id="google-login-btn" onclick="handleGoogleLogin()" style="width:220px; height:44px; font-size:17px; cursor:pointer; display: flex; align-items: center; justify-content: center; margin: 0 auto; border: 1px solid #ccc; background: #fff; border-radius: 5px;">
      <img src="images/Google_LOGO.png" style="width:20px; margin-right:10px;">
      Googleë¡œ ë¡œê·¸ì¸
    </button>
    <button onclick="toggleLoginBox()" style="margin-top:18px; background:none; border:none; cursor:pointer; color: #888;">âœ– ë‹«ê¸°</button>
  </div>
</div>

<div id="settingsModal" class="popup-menu" style="display:none;">
  <div class="popup-content">
    <h2>ì„¤ì •</h2>
    <button onclick="openNicknameModal()">ë‹‰ë„¤ì„ ë³€ê²½</button>
    <button onclick="closeSettingsModal()">ë‹«ê¸°</button>
  </div>
</div>

<div id="nicknameModal" class="popup-menu" style="display:none;">
  <div class="popup-content">
    <h3>ë‹‰ë„¤ì„ ë³€ê²½</h3>
    <input type="text" id="nicknameInput" placeholder="ìƒˆ ë‹‰ë„¤ì„ ì…ë ¥" style="width:80%; padding:10px;" />
    <button onclick="saveNickname()">ì €ì¥</button>
    <button onclick="closeNicknameModal()">ë‹«ê¸°</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  // 1. Supabase ì´ˆê¸°í™”
  const SUPABASE_URL = 'https://lhundplpkgafoozxmiyi.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_jngaJT3f3TOfJciY8LTW9A_AStej1TQ'; 
  
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // 2. êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤í–‰ (ì£¼ì†Œë¥¼ í™•ì‹¤í•˜ê²Œ ê³ ì •í–ˆìŠµë‹ˆë‹¤)
  async function handleGoogleLogin() {
    console.log("êµ¬ê¸€ ë¡œê·¸ì¸ ì‹œë„...");
    const { error } = await supabaseClient.auth.signInWithOAuth({
      provider: 'google',
      options: {
        // ì´ ì£¼ì†Œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤!
        redirectTo: 'https://rainos2009.github.io/Datinoon/'
      }
    });
    if (error) alert("ë¡œê·¸ì¸ ì˜¤ë¥˜: " + error.message);
  }

  // 3. ë¡œê·¸ì•„ì›ƒ
  async function handleLogout() {
    await supabaseClient.auth.signOut();
    alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
    location.reload();
  }

  // 4. UI ì œì–´
  function toggleLoginBox() {
    const box = document.getElementById("login-box");
    box.style.display = (box.style.display === "none" || box.style.display === "") ? "block" : "none";
  }
  function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("active");
    document.getElementById("overlay").classList.toggle("active");
  }
  function openMenu() { document.getElementById('popup-menu').style.display = 'block'; }
  function closeMenu() { document.getElementById('popup-menu').style.display = 'none'; }
  function openSettingsModal() { document.getElementById('settingsModal').style.display = 'block'; }
  function closeSettingsModal() { document.getElementById('settingsModal').style.display = 'none'; }
  function openNicknameModal() { document.getElementById('nicknameModal').style.display = 'block'; }
  function closeNicknameModal() { document.getElementById('nicknameModal').style.display = 'none'; }

  // 5. ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ ë° UI ì—…ë°ì´íŠ¸
  document.addEventListener("DOMContentLoaded", () => {
    supabaseClient.auth.onAuthStateChange((event, session) => {
      const loginBtn = document.getElementById('login-nav-btn');
      const profileArea = document.getElementById('profile-account-area');
      const pName = document.getElementById('profile-name');
      const pImg = document.getElementById('profile-img');

      if (session) {
        const user = session.user;
        if (loginBtn) loginBtn.style.display = "none";
        if (profileArea) profileArea.style.display = "flex";
        if (pName) pName.textContent = user.user_metadata.full_name || user.email;
        if (pImg && user.user_metadata.avatar_url) pImg.src = user.user_metadata.avatar_url;
      } else {
        if (loginBtn) loginBtn.style.display = "block";
        if (profileArea) profileArea.style.display = "none";
      }
    });
  });

  // 6. ë‹‰ë„¤ì„ ì €ì¥
  async function saveNickname() {
    const { data: { user } } = await supabaseClient.auth.getUser();
    const newName = document.getElementById('nicknameInput').value;
    if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    
    const { error } = await supabaseClient
      .from('profiles')
      .upsert({ id: user.id, nickname: newName });

    if (error) alert("ì €ì¥ ì‹¤íŒ¨: " + error.message);
    else { alert("ë‹‰ë„¤ì„ ë³€ê²½ ì„±ê³µ!"); location.reload(); }
  }

  // ì „ì—­ ë“±ë¡
  window.handleGoogleLogin = handleGoogleLogin;
  window.handleLogout = handleLogout;
  window.toggleLoginBox = toggleLoginBox;
  window.toggleSidebar = toggleSidebar;
</script>

</body>
</html>