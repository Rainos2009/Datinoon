<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Datinoon v0.3.2 - 200th Milestone</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* ì „ì²´ ë ˆì´ì•„ì›ƒ ë° êµµì€ ì„  ìŠ¤íƒ€ì¼ */
    :root { --main-border: 3px solid #000; }
    body { margin: 0; background: #fdfdfd; font-family: 'Pretendard', sans-serif; overflow-x: hidden; }

    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 20px; background: #fff; border-bottom: var(--main-border);
      position: sticky; top: 0; z-index: 1000; height: 70px;
    }

    /* ë¡œê³  ë°•ìŠ¤ */
    .logo-box { border: var(--main-border); background: #fff; padding: 2px 8px; display: flex; align-items: center; cursor: pointer; }
    .logo-img { height: 45px; }

    /* ê²€ìƒ‰ì°½ */
    #searchInput {
      width: 450px; padding: 12px; border: var(--main-border);
      font-weight: bold; outline: none; font-size: 16px;
    }

    /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
    .btn-heavy {
      border: var(--main-border); background: #fff; padding: 8px 20px;
      font-weight: 900; cursor: pointer; box-shadow: 3px 3px 0 #000; transition: 0.1s;
    }
    .btn-heavy:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #000; }

    /* ì‚¬ì´ë“œë°” & ì˜¤ë²„ë ˆì´ */
    .sidebar {
      position: fixed; left: -300px; top: 0; width: 280px; height: 100%;
      background: #fff; border-right: var(--main-border); transition: 0.3s; z-index: 2000; padding: 20px;
    }
    .sidebar.active { left: 0; }
    .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1500; }
    .overlay.active { display: block; }

    /* ìœ ì € ë©”ë‰´ íŒì—… (ìœ„ì¹˜ ë³´ì •) */
    .popup-menu {
      display: none; position: absolute; top: 60px; right: 0;
      width: 200px; background: #fff; border: var(--main-border);
      box-shadow: 5px 5px 0 #000; z-index: 1001;
    }

    /* ë©”ì¸ ì¹´ë“œ */
    .intro-card {
      margin: 40px auto; width: 80%; border: var(--main-border);
      padding: 30px; background: #fff; box-shadow: 8px 8px 0 rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>

<header class="header">
  <button class="btn-heavy" onclick="toggleSidebar()" style="font-size:20px; padding:5px 12px;">â‰¡</button>
  
  <div class="logo-box" onclick="location.reload()">
    <img src="images/Rainos.png" class="logo-img" alt="Logo" onerror="this.src='https://via.placeholder.com/150x50?text=Datinoon+0.3.2'">
  </div>

  <div class="center">
    <input type="text" id="searchInput" placeholder="ì‚¬ì§„, ì˜ìƒ í˜¹ì€ ë ˆì¸ ê²€ìƒ‰...">
  </div>

  <div class="right" style="position: relative;">
    <button id="login-nav-btn" class="btn-heavy" onclick="handleGoogleLogin()">ë¡œê·¸ì¸</button>
    
    <div id="profile-area" style="display:none; align-items:center; cursor:pointer;" onclick="toggleMenu()">
      <img src="" id="profile-img" style="width:35px; height:35px; border:2px solid #000; margin-right:10px; border-radius:50%; object-fit:cover;">
      <span id="profile-name" style="font-weight:900;">ì‚¬ìš©ì</span>
    </div>

    <div id="popup-menu" class="popup-menu">
      <div style="padding: 15px; font-weight: 900; border-bottom: 1px solid #eee; cursor: pointer;" onclick="location.href='/Datinoon/profile.html'">ë§ˆì´ í”„ë¡œí•„</div>
      <div style="padding: 15px; font-weight: 900; color: red; cursor: pointer;" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</div>
    </div>
  </div>
</header>

<aside class="sidebar" id="sidebar">
  <h2 style="font-weight: 900;">Datinoon Menu</h2>
  <hr border="1">
  <ul style="list-style:none; padding:0; line-height:3;">
    <li><a href="#" style="text-decoration:none; color:#000; font-weight:900;">ğŸ“ ì±„ë„ íƒìƒ‰</a></li>
    <li><a href="#" style="text-decoration:none; color:#000; font-weight:900;">ğŸï¸ ì˜ìƒ ë³´ê´€í•¨</a></li>
  </ul>
</aside>
<div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

<main>
  <div class="intro-card">
    <h1 style="margin:0 0 10px 0;">Datinoonì´ë€?</h1>
    <p style="font-weight:600; color:#444;">ëˆ„êµ¬ë‚˜ ì‚¬ì§„ê³¼ ì˜ìƒì„ ê³µìœ í•˜ê³  ì¶”ì–µì„ ë§Œë“œëŠ” ììœ ë¡œìš´ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.</p>
  </div>
</main>

<script>
  // 1. Supabase ì´ˆê¸°í™” (ê¸°ì¡´ í‚¤ ì‚¬ìš©)
  const SUPABASE_URL = 'https://lhundplpkgafoozxmiyi.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_jngaJT3f3TOfJciY8LTW9A_AStej1TQ';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // 2. êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤í–‰
  async function handleGoogleLogin() {
    const { error } = await supabaseClient.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: window.location.origin + '/Datinoon/' }
    });
    if (error) console.error("Error:", error.message);
  }

  // 3. ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
  async function handleLogout() {
    await supabaseClient.auth.signOut();
    location.reload();
  }

  // 4. ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ ë° UI ì—…ë°ì´íŠ¸
  supabaseClient.auth.onAuthStateChange((event, session) => {
    const loginBtn = document.getElementById('login-nav-btn');
    const profileArea = document.getElementById('profile-area');
    const profileImg = document.getElementById('profile-img');
    const profileName = document.getElementById('profile-name');

    if (session) {
      loginBtn.style.display = 'none';
      profileArea.style.display = 'flex';
      profileName.textContent = session.user.user_metadata.full_name || "ì‹œë¯¼";
      profileImg.src = session.user.user_metadata.avatar_url || "images/Datinoon_Pro.png";
    } else {
      loginBtn.style.display = 'block';
      profileArea.style.display = 'none';
    }
  });

  // UI í† ê¸€ í•¨ìˆ˜ë“¤
  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('active');
    document.getElementById('overlay').classList.toggle('active');
  }

  function toggleMenu() {
    const menu = document.getElementById('popup-menu');
    menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
  }

  window.onclick = function(event) {
    if (!event.target.closest('.right')) {
      document.getElementById('popup-menu').style.display = 'none';
    }
  }
</script>

</body>
</html>