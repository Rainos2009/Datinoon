<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‹ ë¶„ì¦ - Datinoon</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root { --main-border: 2px solid #000; }
    body { margin: 0; background: #f8f9fa; font-family: 'Pretendard', sans-serif; overflow-x: hidden; }

    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 30px; border-bottom: var(--main-border); background: #fff;
      height: 60px; position: sticky; top: 0; z-index: 1000;
    }
    .logo { height: 40px; cursor: pointer; border: var(--main-border); }

    .profile-section { width: 100%; max-width: 800px; margin: 40px auto; padding: 20px; }

    /* ì‹ ë¶„ì¦ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .id-card {
      background: #fff; border: 3px solid #000; padding: 30px;
      box-shadow: 10px 10px 0 #000; position: relative;
    }
    .profile-main-info { display: flex; align-items: center; margin-bottom: 30px; }
    .profile-avatar {
      width: 100px; height: 100px; border-radius: 12px;
      border: 3px solid #000; margin-right: 25px; object-fit: cover;
    }
    .nickname { font-size: 2.2rem; font-weight: 900; color: #000; margin: 0; }
    .rank-badge { 
      display: inline-block; background: #000; color: #fff; 
      padding: 5px 12px; font-size: 1rem; margin-top: 5px; font-weight: 900;
    }

    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; border-top: 2px solid #eee; pt: 20px; margin-top: 20px; }
    .info-item { display: flex; flex-direction: column; }
    .info-label { font-size: 0.8rem; color: #888; font-weight: 900; margin-bottom: 5px; }
    .info-value { font-size: 1.2rem; font-weight: 900; color: #000; }

    .exp-bar-container { width: 100%; height: 15px; background: #eee; border: 2px solid #000; margin-top: 10px; overflow: hidden; }
    .exp-bar-fill { height: 100%; background: #2ecc71; width: 0%; transition: 0.5s; }

    .action-group { display: flex; justify-content: flex-end; gap: 10px; margin-top: 30px; }
    .btn { 
      border: 2px solid #000; padding: 10px 20px; font-weight: 900; 
      cursor: pointer; background: #fff; box-shadow: 3px 3px 0 #000;
    }
    .btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 #000; }
    .logout-btn { color: #ff4d4d; border-color: #ff4d4d; }
  </style>
</head>
<body>

  <header class="header">
    <button style="background:none; border:none; font-size:24px; cursor:pointer;" onclick="location.href='index.html'">ğŸ </button>
    <img src="images/Datinoon 0.3.2.png" class="logo" onclick="location.href='index.html'" onerror="this.src='https://via.placeholder.com/120x40?text=Datinoon'">
    <div></div>
  </header>

  <section class="profile-section">
    <div class="id-card">
      <div class="profile-main-info">
        <img id="profile-img" src="images/default_avatar.png" class="profile-avatar" />
        <div>
          <h1 id="profile-name" class="nickname">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h1>
          <div id="profile-rank" class="rank-badge">ì‹œë¯¼</div>
        </div>
      </div>

      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">êµ­ê°€ ìˆ™ë ¨ë„ (LEVEL)</span>
          <span id="profile-level" class="info-value">Lv.1</span>
        </div>
        <div class="info-item">
          <span class="info-label">ì†Œì†</span>
          <span class="info-value">ë‹¤í‹°ëˆˆ ì •ê·œêµ°</span>
        </div>
      </div>

      <div style="margin-top: 25px;">
        <span class="info-label">ë‹¤ìŒ ê³„ê¸‰ê¹Œì§€ ê²½í—˜ì¹˜ (EXP)</span>
        <div class="exp-bar-container">
          <div id="profile-exp-bar" class="exp-bar-fill"></div>
        </div>
        <p style="font-size: 0.9rem; text-align: right; margin-top: 5px; font-weight: bold;">
          <span id="exp-text">0</span> / 100
        </p>
      </div>

      <p style="margin-top: 20px; font-size: 0.85rem; color: #666; font-style: italic;">
        * ì˜í†  ì ë ¹ í˜„í™©ì€ 'ì˜í†  ì „ìŸ ì§€ë„'ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
      </p>

      <div class="action-group">
        <button class="btn" onclick="location.href='index.html'">ì „ìŸ ì§€ë„ë¡œ ì´ë™</button>
        <button class="btn logout-btn" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>
  </section>

  <script>
    const SUPABASE_URL = 'https://lhundplpkgafoozxmiyi.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_jngaJT3f3TOfJciY8LTW9A_AStej1TQ';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    supabaseClient.auth.onAuthStateChange(async (event, session) => {
      if (session) {
        const user = session.user;
        document.getElementById("profile-name").textContent = user.user_metadata.full_name;
        document.getElementById("profile-img").src = user.user_metadata.avatar_url;

        // DBì—ì„œ ê³„ê¸‰ ë° ê²½í—˜ì¹˜ ì¡°íšŒ
        const { data: profile } = await supabaseClient
          .from('profiles')
          .select('*')
          .eq('id', user.id)
          .single();

        if (profile) {
          document.getElementById("profile-rank").textContent = profile.Rank;
          document.getElementById("profile-level").textContent = `Lv.${profile.Level || 1}`;
          document.getElementById("exp-text").textContent = profile.EXP;
          document.getElementById("profile-exp-bar").style.width = (profile.EXP % 100) + "%";
          
          // ëŒ€í†µë ¹ì¼ ê²½ìš° ì¹´ë“œ ìƒ‰ìƒ ê°•ì¡°
          if (profile.Rank === 'ëŒ€í†µë ¹') {
            document.querySelector('.id-card').style.borderColor = '#ffD700'; // í™©ê¸ˆìƒ‰
            document.getElementById("profile-rank").style.background = '#ffD700';
            document.getElementById("profile-rank").style.color = '#000';
          }
        }
      } else {
        location.href = "index.html";
      }
    });

    async function handleLogout() {
      await supabaseClient.auth.signOut();
      location.href = "index.html";
    }
  </script>
</body>
</html>