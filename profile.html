<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Datinoon - Profile</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { margin: 0; background: #fff; font-family: 'Malgun Gothic', sans-serif; color: #000; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 50px; border-bottom: 2px solid #000; }
    .logo-img { height: 45px; border: 1px solid #000; cursor: pointer; }
    
    /* 프로필 상단 */
    .profile-header { margin: 30px 50px; border: 2px solid #000; display: flex; align-items: center; padding: 25px; gap: 30px; }
    .user-avatar { width: 100px; height: 100px; border: 3px solid #000; object-fit: cover; }
    .user-info h1 { font-size: 32px; margin: 0; font-weight: 900; }
    .user-meta { color: #888; font-size: 14px; font-weight: bold; margin-top: 5px; }

    /* 탭 메뉴 */
    .tabs { margin: 0 50px; display: flex; border-bottom: 2px solid #000; }
    .tab { padding: 10px 30px; border: 2px solid #000; border-bottom: none; font-weight: 900; margin-right: 10px; background: #fff; cursor: pointer; }
    .tab.active { background: #000; color: #fff; }

    /* 설명 구역 */
    .content-box { margin: 20px 50px; border: 2px solid #000; padding: 30px; }
    .bio-text { font-size: 18px; line-height: 1.6; font-weight: bold; }
    
    .btn { padding: 8px 20px; border: 2px solid #000; background: #eee; font-weight: bold; cursor: pointer; margin-top: 15px; }
    .logout-btn { color: red; font-weight: 900; cursor: pointer; border: none; background: none; font-size: 16px; }
    .logout-btn:hover { text-decoration: underline; }
  </style>
</head>
<body>

<header class="header">
  <img src="https://rainos2009.github.io/Datinoon/images/Datinoon%200.3.2.png" class="logo-img" onclick="location.href='index.html'">
  <button class="logout-btn" onclick="handleLogout()">로그아웃</button>
</header>

<div class="profile-header">
  <img id="display-img" src="" class="user-avatar" onerror="this.src='https://via.placeholder.com/100'">
  <div class="user-info">
    <h1 id="display-name">불러오는 중...</h1>
    <div id="display-date" class="user-meta">가입일 확인 중</div>
    <div style="margin-top:10px;">
      <button class="btn">업로드</button>
      <button class="btn" onclick="location.href='index.html'">커뮤니티</button>
    </div>
  </div>
</div>

<div class="tabs">
  <div class="tab active">설명</div>
  <div class="tab">일정</div>
</div>

<div class="content-box">
  <div style="font-weight:900; font-size:22px; margin-bottom:15px; border-bottom:1px solid #000;">설명</div>
  <div id="display-bio" class="bio-text">
    반갑습니다. Datinoon의 사용자입니다.
  </div>
</div>

<script>
  const SUPABASE_URL = 'https://lhundplpkgafoozxmiyi.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_jngaJT3f3TOfJciY8LTW9A_AStej1TQ';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  async function loadProfile() {
    const { data: { session }, error } = await supabaseClient.auth.getSession();
    
    // 세션이 없으면 메인으로 튕겨냄
    if (!session) { 
      location.href = 'index.html'; 
      return; 
    }

    const user = session.user;
    const name = user.user_metadata.full_name;

    // 1. 이름 및 이미지 표시
    document.getElementById('display-name').textContent = name;
    document.getElementById('display-img').src = user.user_metadata.avatar_url;
    
    // 2. 가입일 표시 (2026. 1. 21. 형식)
    const createdDate = new Date(user.created_at);
    document.getElementById('display-date').textContent = `[가입] ${createdDate.getFullYear()}. ${createdDate.getMonth() + 1}. ${createdDate.getDate()}.`;

    // 3. 운영자(실바) 특별 멘트
    if (name.includes("Silva") || name.includes("실바")) {
      document.getElementById('display-bio').innerHTML = `안녕하십니까, Datinoon의 운영자 '${name}'입니다.<br>전문적인 커뮤니티 공간에 오신 것을 환영합니다.`;
    } else {
      document.getElementById('display-bio').textContent = `안녕하십니까, ${name}입니다.`;
    }
  }

  // ★ 확실한 로그아웃 로직 ★
  async function handleLogout() {
    if (confirm("정말 로그아웃 하시겠습니까?")) {
      const { error } = await supabaseClient.auth.signOut();
      if (error) {
        alert("로그아웃 실패: " + error.message);
      } else {
        // 완전히 로그아웃된 후 메인으로 이동
        window.location.replace('index.html'); 
      }
    }
  }

  loadProfile();
</script>
</body>
</html>