<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Datinoon - Profile</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { margin: 0; background: #fff; font-family: 'Malgun Gothic', sans-serif; color: #000; }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 50px; border-bottom: 2px solid #000; }
    .logo-img { height: 45px; border: 1px solid #000; cursor: pointer; }
    
    .profile-header { margin: 30px 50px; border: 2px solid #000; display: flex; align-items: center; padding: 25px; gap: 30px; }
    .user-avatar { width: 100px; height: 100px; border: 3px solid #000; object-fit: cover; }
    .user-info h1 { font-size: 32px; margin: 0; font-weight: 900; }
    .user-meta { color: #888; font-size: 14px; font-weight: bold; margin-top: 5px; }

    .tabs { margin: 0 50px; display: flex; border-bottom: 2px solid #000; }
    .tab { padding: 10px 30px; border: 2px solid #000; border-bottom: none; font-weight: 900; margin-right: 10px; background: #fff; cursor: pointer; }
    .tab.active { background: #000; color: #fff; }

    .content-box { margin: 20px 50px; border: 2px solid #000; padding: 30px; }
    .bio-text { font-size: 18px; line-height: 1.6; font-weight: bold; }
    
    .btn { padding: 8px 20px; border: 2px solid #000; background: #eee; font-weight: bold; cursor: pointer; margin-top: 15px; }
    
    /* 로그아웃 버튼 강조 스타일 */
    .logout-btn { 
      color: red !important; 
      font-weight: 900 !important; 
      cursor: pointer !important; 
      border: none !important; 
      background: none !important; 
      font-size: 16px;
      padding: 10px;
    }
  </style>
</head>
<body>

<header class="header">
  <img src="images/Datinoon_0.4.1.png" class="logo-img" onclick="location.href='index.html'">
  <button type="button" class="logout-btn" onclick="handleLogout()">로그아웃</button>
</header>

<div class="profile-header">
  <img id="display-img" src="" class="user-avatar" onerror="this.src='https://via.placeholder.com/100'">
  <div class="user-info">
    <h1 id="display-name">로딩 중...</h1>
    <div id="display-date" class="user-meta">가입일 확인 중</div>
    <div style="margin-top:10px;">
      <button class="btn">업로드</button>
      <button class="btn" onclick="location.href='index.html'">커뮤니티</button>
    </div>
  </div>
</div>

<div class="tabs">
  <div class="tab active">설명</div>
  <div class="tab">일정</div>
</div>

<div class="content-box">
  <div style="font-weight:900; font-size:22px; margin-bottom:15px; border-bottom:1px solid #000;">설명</div>
  <div id="display-bio" class="bio-text">
    불러오는 중...
  </div>
</div>

<script>
  const SUPABASE_URL = 'https://lhundplpkgafoozxmiyi.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_jngaJT3f3TOfJciY8LTW9A_AStej1TQ';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // ★ 1. 로그아웃 함수를 가장 먼저 선언하여 즉시 인식되게 함
  async function handleLogout() {
    console.log("로그아웃 시도 중...");
    const { error } = await supabaseClient.auth.signOut();
    if (error) {
      alert("로그아웃 실패: " + error.message);
    } else {
      // 로그아웃 후 즉시 메인 페이지로 이동
      window.location.replace('index.html');
    }
  }

  // 2. 프로필 정보 로드
  async function loadProfile() {
    const { data: { session } } = await supabaseClient.auth.getSession();
    if (!session) { 
      location.href = 'index.html'; 
      return; 
    }

    const user = session.user;
    const metadata = user.user_metadata;

    document.getElementById('display-name').textContent = metadata.full_name;
    document.getElementById('display-img').src = metadata.avatar_url;
    
    // 가입일 포맷 (2026. 1. 21. 형태 유지)
    const d = new Date(user.created_at);
    document.getElementById('display-date').textContent = `[가입] ${d.getFullYear()}. ${d.getMonth() + 1}. ${d.getDate()}.`;

    // 설명란
    const bio = document.getElementById('display-bio');
    if (metadata.full_name.includes("Silva") || metadata.full_name.includes("실바")) {
      bio.innerHTML = `안녕하십니까, Datinoon의 운영자 '${metadata.full_name}'입니다.<br>전문적인 커뮤니티 공간에 오신 것을 환영합니다.`;
    } else {
      bio.textContent = `안녕하십니까, ${metadata.full_name}입니다.`;
    }
  }

  loadProfile();
</script>
</body>
</html>